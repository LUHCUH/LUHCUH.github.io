---
title: 容斥原理
categories:
  - oi知识点
date: 2024-11-14 18:54:59
---

- 题记：由于不到一年就退役了，于是打算重学容斥原理

## 表达式

- 容斥原理是建立在集合的基础上，描述集合大小之间的关系的的（以前以为是对于元素来说的）
- 对于 $n$ 个集合 $A_i$ 有

$$
|\bigcup_{i=1}^n A_i|=\sum_{i=1}^n|A_i|-\sum_{i<j}|A_i\cap A_j|+\cdots (-1)^{n-1}|\bigcap_{i=1}^n A_i|
$$

- 若我们定义可重集 $S=\{A_1,A_2,\cdots,A_n\}$，则有更简单的形式

$$
|\bigcup_{A\in S}A|=\sum_{T\subseteq S}(-1)^{|T|-1}|\bigcap_{A\in T}A|
$$

> [!tip]
>
> - 任取一个元素 $x$
>   - 若 $x\notin \bigcup_{i=1}^n A_i$ 显然，$x$ 不属于左式，右式任何一个集合，故对二式影响一样
>   - 若 $x \in \bigcup_{i=1}^n A_i$，显然左式中集合含有 $x$，$x$ 对左式集合大小的影响为 $1$
>     - 对于右式我们假设 $x$ 属于 $A_1,\dots,A_n$ 中的 $m\in[1,n]$ 个集合
>     - 那么统计$\sum\limits_{T\subseteq S}|\bigcap\limits_{A\in T}A|$ 的值，就是统计
>     - 从 $n$ 个集合中选出 $|T|$ 个集合，且 $|T|$ 个集合都中都有 $x$ 的方案数个数，即 $\binom{m}{|T|}[|T|\le m]$
>     - 即右式 $=\sum\limits_{i=1}^m (-1)^{i-1}\binom{m}{i}=1-\sum_{i=0}^m(-1)^i\binom{m}{i}=1-(1-1)^m=1$

- 接着我们来证明容斥原理


## 子集卷积

- 哎，我还是太菜了，竟只能感觉，却不能描述出它与容斥原理那些微妙的关系
- 对于有关集合的函数 $f(S),g(S)$ 

$$
f(S)=\sum\limits_{T\subseteq S}g(T) \Rightarrow g(S)=\sum\limits_{T\subseteq S}(-1)^{|S|-|T|}f(T)
$$

$$
f(S)=\sum\limits_{S\subseteq T}g(T) \Rightarrow g(S)=\sum\limits_{S\subseteq T}(-1)^{|T|-|S|}f(T)
$$

> [!tip]
>
> 先证明 $f(S)=\sum\limits_{T\subseteq S}g(T) \Rightarrow g(S)=\sum\limits_{T\subseteq S}(-1)^{|S|-|T|}f(T)$，考虑右式有
> $$
> \begin{aligned}
> f(S)&=\sum\limits_{T\subseteq S}(-1)^{|S|-|T|}f(T)=\sum\limits_{T\subseteq S}(-1)^{|S|-|T|}\sum\limits_{K\subseteq T}g(K)\\
> &=\sum_{K\subseteq S}g(K)\sum_{K\subseteq T\subseteq S}(-1)^{|S|-|T|}=\sum_{K\subseteq S}g(K)\sum_{len=0}^{|S|-|K|}(-1)^{|S|-|K|-i}\\
> &=\sum_{K\subseteq S}g(K)(1-1)^{|S|-|K|}
> \end{aligned}
> $$
>
> 仔细分析，当 $|S|=|K|$ 时，$0^0$ 直接考虑原式，发现此时系数为 $1$
>
> 其他情况 $a^0(a\not=0)=1$，系数为 $0$，所以只有 $S=K$ 的时候右式有值为 $g(S)$
>
> 至于 $f(S)=\sum\limits_{S\subseteq T}g(T) \Rightarrow g(S)=\sum\limits_{S\subseteq T}(-1)^{|T|-|S|}f(T)$ 依旧是类似的，可推出
> $$
> f(S)=\sum_{S\subseteq K}g(K)\sum_{S\subseteq T\subseteq K}(-1)^{|T|-|S|}=\sum_{S\subseteq K}g(K)(1-1)^{|K|-|S|}
> $$
> 之后讨论与前面情况类似，于是得证

### {% post_link OI/solution/CF/CF1613F 'Tree coloring' %}

### {% post_link OI/solution/LG/P5505 '[JSOI2011] 分特产' %}

### {% post_link OI/solution/LG/P3349 '[ZJOI2016] 小星星' %}

### {% post_link OI/solution/CF/CF1466H 'CF1466H Finding satisfactory' %}

### {% post_link OI/solution/ACCNOI/contest/550/D '点亮 (light)' %}

## 不定方程非负整数解计数

- 有一堆方程，$\sum\limits_{i=1}^n x_i=m,\forall x_i\le b_i(b_i,m\in N)$，求不定方程组解的个数
- 首先，在不考虑 $b_i$ 的限制的情况下，我们有 $Ans=\binom{m+n-1}{n-1}$，插板法
- 接着考虑若限制是形如 $\forall b_i\le x_i$ 的我们会不会做，可以通过组合数直接计算 $Ans=\binom{m+n-1-\sum\limits_{i=1}^nb_i}{n-1}$
- 而 $x_i\le b_i$ 与 $b_i\le x_i$ 本质上相对立，于是我们设 $S_i=\{$ $x_i\le b_i$ $\}$，自然地 $\overline{S_i}=\{x_i\ge b_i+1\}$，集合里的元素是一组解
- 于是我们有 $|\bigcap S_i|=\binom{m+n-1}{n-1}-|\bigcup \overline{S_i}|$​，至于 $\bigcup\overline{S_i}$ 直接按照第三步暴力枚举子集计算即可

### {% post_link OI/solution/LG/P1450 'P1450 [HAOI2008] 硬币购物' %}

### {% post_link OI/solution/ACCNOI/contest/566/C '人口局 DBA（dba）' %}
