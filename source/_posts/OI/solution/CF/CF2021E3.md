---
title: Digital Village (Extreme Version 树上问题，化链剖分)
tags:
  - Codeforces
  - kruskal重构树
  - 链剖分
  - 闵科夫斯基和
date: 2024-11-20 07:47:47
---

### [Digital Village (Extreme Version 树上问题，化链剖分)]()

- 题目简述，有 $n$ 个点，$m$ 条边的图，边有边权 $e_i$，点有点权 $s_i$，我们要从中选择 $k\in [1,n]$ 的点
- 设选的为 $a_1,a_2,\cdots,a_k$ 的点，则总代价为 $\sum s_i\times min path(i,a_i)$，其中 $path(x,y)$ 表示 $x$ 到 $y$ 的边权最大值。对于每一个 $k$ 都想知道最小代价是多少
- 题目分析
- 首先对于最大边权的贡献，考虑做 kruskal重构树。之后，把边权放到费叶子节点点权上。
- 之后，尝试把路径的贡献划分到点，对于 $u$，$newval_u=siz_u(val_{fa_u}-val_{u})$，就是 $u$ 字数内的点若不在字数内被解决，就要多花费多少链向外面
- 于是初始状态就是，所有 $newval$ 的和，选择若干条最大的从叶子到根的路径，使得点权最大，这就是长链剖分每次选最长链。
- [至此本题做完](https://www.luogu.com.cn/article/c95mlhma)。
- 考虑其他做法，我们有了长链剖分的基础，就可以证明，选 $k-1$ 个点一定是选 $k$ 个点的子集。
- 我们设 $f_{u,i}$ 表示 $u$ 子树内选了 $i$ 个点的方案数量。考虑合并两个儿子。
- $f_{u,i+j}=\min(f_{v_1,i}+f_{v_2,j})$，特别的 若 $f_{v_1,0}$ 则必须选当前边，改变一下 $f_{v_1,0},f_{v_2,0}$ 的贡献即可。
- 上述式子 $f_{u,i+j}=\min(f_{v_1,i}+f_{v_2,j})$ 是传说中的 $(min,+)$ 卷积，而且 $f_{u,i},f_{u,i+1}$ 满足下凸。
- 不妨考虑记 $f$ 的差分数组，二者差分数组排序，就是合并的 $f$ 的答案。考虑为什么，若存在一种合法的构造那么一定是最小的，显然对于二者分取前缀即可取到最小，显然的证，这就是传说中的 **闵科夫斯基和**。