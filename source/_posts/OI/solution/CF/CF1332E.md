---
title: Height All the Same
tags:
  - Codeforces
  - 奇偶性
date: 2024-11-14 18:20:49
---

### [Height All the Same](https://www.luogu.com.cn/problem/CF1332E)

- 题目简述：有一个棋盘大小为 $n\times m$，一开始位置 $(i,j)$ 有一些 $a_{i,j}$ 个方块
- 每次操作可以给一个位置上加两个方块，或给相邻位置加一个方块如图，一个棋局是好的，当且仅当能够从过若干次操作使得所有位置方块高度一致。

![image-20241113161626356](https://image-1311841823.cos.ap-beijing.myqcloud.com/blog/image-20241113161626356.png)

- 给定 $L,R,n,m$，问有多少初始局面 $L\le a_{i,j}\le R$ 是好的。 $0\le L,R,n,m\le 10^9$

- 题解：
- 首先你需要想到，尝试对奇偶性分类，发现，一个操作使得奇偶性不变，一个操作使得相邻两个奇偶性改变。
- 若存在时刻棋盘所有格子奇偶性相同，那么必然可以通过不断加 $2$ 格高，使得高度统一。
- 对初始局面我们求完奇偶性，第一时间我想什么找路径，多米诺骨牌填充，直到想到了像这样
- <img src="https://image-1311841823.cos.ap-beijing.myqcloud.com/blog/image-20241113163121657.png" alt="image-20241113163121657" style="zoom:50%;" /> 的一条一条路径，这有什么好处呢？相当于中间的部分奇偶性不变，端点奇偶性改变
- 什么意思，就是一个棋局中按出状态奇偶性计数，存在偶数一定是好的，否则一定是坏的。
- 显然奇数棋盘必然会被分成一奇，一偶数，所以必然有解，答案即为 $(R-L+1)^{nm}$
- 至于偶数，可能会被分成两个奇数，除了这种情况都是对的。记 $a$ 为 $[L,R]$ 中奇数的个数，$b$ 为偶数的个数

$$
\begin{aligned}
ans&=\sum\limits_{i=0}^{\frac{nm}{2}}a^{2i}b^{nm-2i}\\
ans&=\frac{1}{2}\sum_{i=0}^{nm}a^ib^{nm-i}+\frac{1}{2}\sum_{i=0}^{nm}(-a)^ib^{nm-i}\\
ans&=\frac{1}{2}(a+b)^{nm}-\frac{1}{2}(b-a)^{nm}
\end{aligned}
$$

- 这里注意如果使用了欧拉定理把 $nm \bmod 998244352$ 的话可能会出现，底数为 $0$，指数同为 $0$ 的情况。此时指数 视为正数，特判为 $0$
- 注：本题同时也是二项式定理求错位项的方法。