---
title: 点亮(light)
message: dsfz NOI篇 的密码
tags:
  - accnoi
date: 2024-11-14 18:42:44
---
### [点亮 (light)](http://47.92.197.167:5283/contest/550/problem/4)

- 题目简述，给你一个完全图，给 $\binom{n}{2}$ 条边，赋 $[1,\binom{n}{2}]$ 的权。每个点保护权与它相连，权最大的边。未被保护的边被删，求有多大概率会被变成 $k$ 个联通块
- 赛时不会做，悲！
- 先分析题目，约定 $c(x,y)$ 表示 $x,y$ 之间的边权
  - 对联通块分析：一个联通块大小为 $x$ 有 $x$ 条边，是基环树，仔细观察，环一定是一个二元环
    - 因为若存在更大的环设 $a\rightarrow b\rightarrow c\rightarrow a$，$c(a,b)>c(a,c)=c(c,a)>c(c,b)=c(b,c)>c(b,a)=c(a,b)$ 故 $c(a,b)\not=c(b,a)$ 的证
  - 计数吧，一般总是有顺序的，考虑从大到小考虑加边
- 那就设 $dp_{i,j}$ 表示已经有了 $k$ 个联通块，用了 $j$ 个点
  - $dp_{i,j}\rightarrow dp_{i+1,j+2}$ 加一个联通块加两个点
    - 具体的：$dp_{i,j}\binom{n-j}{2}\frac{1}{\binom{n}{2}-\binom{j}{2}}\rightarrow dp_{i+1,j+2}$
    - 解释一下，随便在剩余的点中选两个点，而且新加的点要满足，在所有不在[已选点构成的导出子图 $\binom{j}{2}$] 中的边的边权小于新选的点。而这个数量分之一，就作为这种选法的概率。就是 $P(\text{可以转移})=$ 在全排列中，当前选的边是首个的概率，由于边都是等价的，所以等于边数分之一
  - $dp_{i,j}\rightarrow dp_{i,j+1}$
    - 具体的：$dp_{i,j}(n-j)j\frac{1}{\binom{n}{2}-\binom{j}{2}}$
    - 概率的解释同上，方案数就是原来的点集向其他的点集连边的数量。
- 这就是 $O(n^2)$ 的做法。
- 再说正解，哪也没啥了，说白了就是把加点的过程给优化了，直接改成统计联通块了
- 设 $G(S)$ 表示选了 $|S|$ 个边作为关键边，就是加联通块的二元环的两个点。
- 考虑 $G(S)$ 怎么求，发现这是困难的
  - 阐述一下哪里困难，首先我们必须要钦定那些点是构成联通块的，这是能办到的，
  - 接着我们要想办法把独立点加入已有联通块，这个是很难得，因为独立点向加入一个联通块要满足，边权小于，联通块最初的两点的边权。而这只有上述 $dp$ 可以做到，没办法大概线性计算。你要记录每个联通块初始边权的话状态太多，这就没啥前途的。
- 话说数数题总是要容斥的吧。于是，设 $F(S)$ 表示钦定 $|S|$ 个边作为关键边，至于其他边，不做考虑的概率。
- 有 $F(S)=\sum\limits_{S\subseteq T} G(T)$，我们尝试只记录集合大小即 $|S|,|T|$，有 $G(S)=\sum\limits_{S\subseteq T} (-1)^{|T|-|S|} F(T)$，

$$
ans=\sum_{|S|=k}G(S)=\sum_{|S|=k}\sum_{S\subseteq T} (-1)^{|T|-|S|} F(T)=\sum_{|S|=k}\sum_{k \le |T|}(-1)^{|T|-|S|}F(T)
$$

- 若式子为这样，正确性是对的，但由于存在不合法的 $F(T)$ 所以不是所有的 $F(T)$ 的值都一样，只能取合法的数量。而除了处理集合关系外，还要处理合法关系 $\sum_{k\le |T|}$ 就显得过于复杂了，于是

$$
\begin{aligned}
ans&=\sum_{|S|=k}\sum_{k \le |T|}(-1)^{|T|-|S|}F(T)=\sum_{k\le |T|}\binom{|T|}{k}(-1)^{|T|-|S|}F(T)\\
&=\sum_{k\le i}\binom{i}{k}(-1)^{i-k}num(i)F(i)
\end{aligned}
$$

- 其实这里，没准要说一下，你枚举超级存在不合法的，计数困难，枚举子集全部都合法可以组合数，所以调换了枚举顺序。
- 剩下的就是计算 $F(x)$，和 $num(x)$
  - $F(x)=x!\prod\limits_{i=1}^{x}\frac{1}{\binom{n}{2}-\binom{n-2i}{2}}$，现在考虑对它计数，我们依旧按照边的大小关系考虑，所有点分三种，钦定的关键点连向非关键点，若要保证关键边是关键边，就要保证这种连边关系边权小于它。第二种是关键点连向关键点，这种边也要小于关键边。第三种是非关键点连向非关键点，由于只是钦定了 $x$ 个关键边，与这种边利益不冲突，所以这种边随便。综上最大的边要在 $\binom{n}{2}-\binom{n-2x}{2}$ 个边种保持最大，以此类推，概率可知。由于钦定了边权的大小关系，所以成个排列 $x!$。
  - $num(x)=\binom{n}{2}\binom{n-2}{2}\cdots \binom{n-2x+2}{2}=\frac{\binom{n}{2x}\binom{2x}{x}x!}{2^x}=\frac{n!}{(n-2x)!x!2^x}$